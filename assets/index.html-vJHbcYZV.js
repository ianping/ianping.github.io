import{_ as a,c as e,b as i,o as n}from"./app-DsGHT65_.js";const l="data:image/png;base64,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",p="/assets/20240317183823-C9IEUiHx.png",d="/assets/20240317183824-BGINZ2wV.png",t="/assets/20240317162137-BB7Vo6J9.png",r="/assets/20240317162706-EojATd2g.png",c="/assets/20240317162812-But54YTT.png",h="/assets/20240317183825-C01_7X2h.png",o={};function k(m,s){return n(),e("div",null,s[0]||(s[0]=[i(`<h2 id="数据迁移" tabindex="-1"><a class="header-anchor" href="#数据迁移"><span>数据迁移</span></a></h2><h3 id="move" tabindex="-1"><a class="header-anchor" href="#move"><span><code>move</code></span></a></h3><p><code>move</code>命令适用于在单个Redis实例中，将key从当前数据库移动到另一个数据库。</p><p>示例：</p><div class="language-sh line-numbers-mode" data-ext="sh" data-title="sh"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes github-light material-theme-darker vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#545454;--shiki-dark-font-style:italic;"># 将hello键值对从当前数据库移动到数据库1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#FFCB6B;">move</span><span style="--shiki-light:#032F62;--shiki-dark:#C3E88D;"> hello</span><span style="--shiki-light:#005CC5;--shiki-dark:#F78C6C;"> 1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="dump-restore" tabindex="-1"><a class="header-anchor" href="#dump-restore"><span><code>dump</code> + <code>restore</code></span></a></h3><p><code>dump</code>命令将1个key的值序列化为RDB格式的序列，<code>restore</code>命令从RDB序列中恢复key的值。</p><p>组合2个命令可实现在不同Redis实例之间进行数据迁移。</p><p>示例：</p><div class="language-sh line-numbers-mode" data-ext="sh" data-title="sh"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes github-light material-theme-darker vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#545454;--shiki-dark-font-style:italic;"># 在一个Redis中，序列换键hello的值</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#FFCB6B;">dump</span><span style="--shiki-light:#032F62;--shiki-dark:#C3E88D;"> hello</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#545454;--shiki-dark-font-style:italic;"># 在另一个Redis中，从序列中恢复值。键过期时间为0，表示不设置过期时间</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#FFCB6B;">restore</span><span style="--shiki-light:#032F62;--shiki-dark:#C3E88D;"> hello</span><span style="--shiki-light:#005CC5;--shiki-dark:#F78C6C;"> 0</span><span style="--shiki-light:#032F62;--shiki-dark:#89DDFF;"> &quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#C3E88D;">\\x00\\x05world\\x0b\\x00p\\x0e\\x81\\xf7-6\\x9bK</span><span style="--shiki-light:#032F62;--shiki-dark:#89DDFF;">&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="migrate" tabindex="-1"><a class="header-anchor" href="#migrate"><span><code>migrate</code></span></a></h3><p><code>migrate</code>命令用于在不同Redis实例之间迁移数据。语法如下：</p><div class="language-sh line-numbers-mode" data-ext="sh" data-title="sh"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes github-light material-theme-darker vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#FFCB6B;">migrate</span><span style="--shiki-light:#032F62;--shiki-dark:#C3E88D;"> host</span><span style="--shiki-light:#032F62;--shiki-dark:#C3E88D;"> port</span><span style="--shiki-light:#032F62;--shiki-dark:#C3E88D;"> key</span><span style="--shiki-light:#D73A49;--shiki-dark:#89DDFF;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#FFCB6B;">&quot;&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#C3E88D;"> destination-db</span><span style="--shiki-light:#032F62;--shiki-dark:#C3E88D;"> timeout</span><span style="--shiki-light:#24292E;--shiki-dark:#EEFFFF;"> [COPY] </span><span style="--shiki-light:#24292E;--shiki-dark:#89DDFF;">[</span><span style="--shiki-light:#24292E;--shiki-dark:#EEFFFF;">REPLACE</span><span style="--shiki-light:#24292E;--shiki-dark:#89DDFF;">]</span><span style="--shiki-light:#24292E;--shiki-dark:#89DDFF;"> [</span><span style="--shiki-light:#24292E;--shiki-dark:#EEFFFF;">AUTH password</span><span style="--shiki-light:#D73A49;--shiki-dark:#89DDFF;">|</span><span style="--shiki-light:#24292E;--shiki-dark:#EEFFFF;">AUTH2 username password</span><span style="--shiki-light:#24292E;--shiki-dark:#89DDFF;">]</span><span style="--shiki-light:#24292E;--shiki-dark:#89DDFF;"> [</span><span style="--shiki-light:#24292E;--shiki-dark:#EEFFFF;">KEYS key </span><span style="--shiki-light:#24292E;--shiki-dark:#89DDFF;">[</span><span style="--shiki-light:#24292E;--shiki-dark:#EEFFFF;">key ...</span><span style="--shiki-light:#24292E;--shiki-dark:#89DDFF;">]]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>参数说明：</p><ul><li><code>host</code>：目标Redis实例IP</li><li><code>port</code>：目标Redis实例端口</li><li><code>key|&quot;&quot;</code>：如果迁移1个键，则写键名；否则，写空字符串</li><li><code>destination-db</code>：目标Redis实例数据库</li><li><code>timeout</code>：超时时间，单位毫秒</li><li><code>[COPY]</code>：可选，迁移后不删除源key</li><li><code>[REPLACE]</code>：可选，如果目标Redis实例中存在同名的key，直接替换</li><li><code>[AUTH password|AUTH2 username password]</code>：可选，目标Redis的用户名和密码</li><li><code>[KEYS key [key ...]]</code>：可选，迁移多个键时，指定键列表</li></ul><h2 id="数据持久化机制" tabindex="-1"><a class="header-anchor" href="#数据持久化机制"><span>数据持久化机制</span></a></h2><p>Redis 提供了两种主要的持久化方式，分别是 RDB（Redis DataBase）和 AOF（Append Only File）。这两种方式可以单独或同时使用。</p><h3 id="rdb-保存快照" tabindex="-1"><a class="header-anchor" href="#rdb-保存快照"><span>RDB: 保存快照</span></a></h3><p>RDB（Redis Database），是一种快照持久化方式，将内存中的数据保存到磁盘上的二进制文件中，Redis重启时用RDB文件恢复数据。</p><p>RDB文件保存Redis在某个时间点的数据，其优点是快速、文件紧凑，适合备份大规模数据；缺点是无法做到实时持久化，会丢失最后一次快照之后的所有数据。</p><p><strong>手动触发RDB吃计划</strong></p><p>执行<code>save</code> 或 <code>bgsave</code>命令。</p><p>另外，执行<code>shutdown</code>命令关闭Redis服务器时，也会自动执行<code>bgsave</code>命令</p><p><strong>自动触发RDB持久化</strong></p><div class="language- line-numbers-mode" data-ext="" data-title=""><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes github-light material-theme-darker vp-code"><code><span class="line"><span>dir ./</span></span>
<span class="line"><span>dbfilename dump.rdb</span></span>
<span class="line"><span></span></span>
<span class="line"><span># save &lt;seconds&gt; &lt;changes&gt; [&lt;seconds&gt; &lt;changes&gt; ...]</span></span>
<span class="line"><span>save 3600 1 300 100 60 10000</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 禁用RDB自动持久化</span></span>
<span class="line"><span># save &quot;&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="aof-只追加文件" tabindex="-1"><a class="header-anchor" href="#aof-只追加文件"><span>AOF: 只追加文件</span></a></h3><p>AOF（Append Only File），是一种日志持久化方式，将每一个写命令追加到日志文件末尾，记录数据库的变更记录，Redis重启时重写执行AOF日志文件中的命令来恢复数据。</p><p>开启AOF后，Redis重启时，优先加载AOF持久化文件。</p><p>AOF持久化方式的优点是数据完整性高、适合增量更新；缺点是AOF文件较大、且恢复数据较慢。</p><p><strong>配置项</strong></p><div class="language- line-numbers-mode" data-ext="" data-title=""><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes github-light material-theme-darker vp-code"><code><span class="line"><span># 开启AOF</span></span>
<span class="line"><span>appendonly yes</span></span>
<span class="line"><span></span></span>
<span class="line"><span>appendfilename &quot;appendonly.aof&quot;</span></span>
<span class="line"><span>appenddirname &quot;appendonlydir&quot;</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 写入磁盘的策略</span></span>
<span class="line"><span># appendfsync always</span></span>
<span class="line"><span>appendfsync everysec</span></span>
<span class="line"><span># appendfsync no</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 自动触发AOF重写: aof文件至少为64mb，且达到上次重写时aof文件大小的100%</span></span>
<span class="line"><span>auto-aof-rewrite-percentage 100</span></span>
<span class="line"><span>auto-aof-rewrite-min-size 64mb</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>通过AOF重写，可以减小AOF文件的大小，通过以下2个配置项自动触发AOF重写：</p><ul><li><code>auto-aof-rewrite-percentage</code>：AOF文件达到上次重写后文件大小的百分比</li><li><code>auto-aof-rewrite-min-siz</code>：AOF文件至少多大时，才触发重写。默认64mb</li></ul><p>另外，可以通过命令<code>bgrewriteaof</code>，手动触发AOF重写。</p><h2 id="主从复制机制" tabindex="-1"><a class="header-anchor" href="#主从复制机制"><span>主从复制机制</span></a></h2><blockquote><p>参考：https://redis.io/docs/management/replication/</p></blockquote><p>Redis复制（Replication）是指将master服务器的数据同步到slave服务器的架构。主从复制步骤如下：</p><ol><li>从节点连接到主节点，主节点发送全量数据给从节点</li><li>从节点监听来自主节点的写操作，主节点将写操作发送给从节点，从节点执行同样的写操作，从而实现数据的增量更新</li><li>从节点重新上线后，会重新向主节点请求全量数据</li></ol><p>Redis主从复制的优点包括：</p><ul><li>提高了系统的可用性和容错性</li><li>支持读写分离；</li></ul><p>Redis主从复制的缺点包括：</p><ul><li>主从复制是异步执行，存在延迟问题</li><li>存在主服务器的单点故障问题</li></ul><p>使用命令：<code>info replication</code> 查看主从服务信息。</p><h3 id="主从复制的拓扑结构" tabindex="-1"><a class="header-anchor" href="#主从复制的拓扑结构"><span>主从复制的拓扑结构</span></a></h3><h4 id="一主一从" tabindex="-1"><a class="header-anchor" href="#一主一从"><span>一主一从</span></a></h4><p>1个master实例、1个slave实例。当主节点故障时，可以将从节点升级为主节点。</p><p><img src="`+l+'" alt=""></p><h4 id="一主多从" tabindex="-1"><a class="header-anchor" href="#一主多从"><span>一主多从</span></a></h4><p>1个master实例、多个slave实例。主节点负责写、从节点负责读，可实现读写分离。</p><p><img src="'+p+'" alt=""></p><h4 id="树状" tabindex="-1"><a class="header-anchor" href="#树状"><span>树状</span></a></h4><p>slave实例也可以同时充当master实例的角色。从节点既可以复制主节点的数据，也可作为主节点，向下层从节点复制数据，降低主节点的写操作压力。</p><p><img src="'+d+`" alt=""></p><h3 id="快速开始" tabindex="-1"><a class="header-anchor" href="#快速开始"><span>快速开始</span></a></h3><h4 id="环境准备" tabindex="-1"><a class="header-anchor" href="#环境准备"><span>环境准备</span></a></h4><p>&quot;一主多从&quot;拓扑结构为例：采用1台master服务器+2台slave服务的架构，用docker创建Redis容器。</p><p><strong>创建3个Redis容器</strong></p><p>拉取镜像：<code>docker pull redis:7</code></p><p>master实例</p><div class="language-sh line-numbers-mode" data-ext="sh" data-title="sh"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes github-light material-theme-darker vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#FFCB6B;">mkdir</span><span style="--shiki-light:#005CC5;--shiki-dark:#C3E88D;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#C3E88D;"> /docker/redis7/conf/</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#FFCB6B;">touch</span><span style="--shiki-light:#032F62;--shiki-dark:#C3E88D;"> /docker/redis7/conf/redis.conf</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#FFCB6B;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#C3E88D;"> create</span><span style="--shiki-light:#005CC5;--shiki-dark:#C3E88D;"> --name</span><span style="--shiki-light:#032F62;--shiki-dark:#C3E88D;"> redis7</span><span style="--shiki-light:#005CC5;--shiki-dark:#C3E88D;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#C3E88D;"> 6379:6379</span><span style="--shiki-light:#005CC5;--shiki-dark:#C3E88D;"> -v</span><span style="--shiki-light:#032F62;--shiki-dark:#C3E88D;"> /docker/redis7/conf:/etc/redis</span><span style="--shiki-light:#005CC5;--shiki-dark:#C3E88D;"> -v</span><span style="--shiki-light:#032F62;--shiki-dark:#C3E88D;"> /docker/redis7/data:/data</span><span style="--shiki-light:#032F62;--shiki-dark:#C3E88D;"> redis:7</span><span style="--shiki-light:#032F62;--shiki-dark:#C3E88D;"> redis-server</span><span style="--shiki-light:#032F62;--shiki-dark:#C3E88D;"> /etc/redis/redis.conf</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>slave实例a</p><div class="language-sh line-numbers-mode" data-ext="sh" data-title="sh"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes github-light material-theme-darker vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#FFCB6B;">mkdir</span><span style="--shiki-light:#005CC5;--shiki-dark:#C3E88D;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#C3E88D;"> /docker/redis7a/conf/</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#FFCB6B;">touch</span><span style="--shiki-light:#032F62;--shiki-dark:#C3E88D;"> /docker/redis7a/conf/redis.conf</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#FFCB6B;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#C3E88D;"> create</span><span style="--shiki-light:#005CC5;--shiki-dark:#C3E88D;"> --name</span><span style="--shiki-light:#032F62;--shiki-dark:#C3E88D;"> redis7a</span><span style="--shiki-light:#005CC5;--shiki-dark:#C3E88D;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#C3E88D;"> 6377:6379</span><span style="--shiki-light:#005CC5;--shiki-dark:#C3E88D;"> -v</span><span style="--shiki-light:#032F62;--shiki-dark:#C3E88D;"> /docker/redis7a/conf:/etc/redis</span><span style="--shiki-light:#005CC5;--shiki-dark:#C3E88D;"> -v</span><span style="--shiki-light:#032F62;--shiki-dark:#C3E88D;"> /docker/redis7a/data:/data</span><span style="--shiki-light:#032F62;--shiki-dark:#C3E88D;"> redis:7</span><span style="--shiki-light:#032F62;--shiki-dark:#C3E88D;"> redis-server</span><span style="--shiki-light:#032F62;--shiki-dark:#C3E88D;"> /etc/redis/redis.conf</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>slave实例b</p><div class="language-sh line-numbers-mode" data-ext="sh" data-title="sh"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes github-light material-theme-darker vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#FFCB6B;">mkdir</span><span style="--shiki-light:#005CC5;--shiki-dark:#C3E88D;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#C3E88D;"> /docker/redis7b/conf/</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#FFCB6B;">touch</span><span style="--shiki-light:#032F62;--shiki-dark:#C3E88D;"> /docker/redis7b/conf/redis.conf</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#FFCB6B;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#C3E88D;"> create</span><span style="--shiki-light:#005CC5;--shiki-dark:#C3E88D;"> --name</span><span style="--shiki-light:#032F62;--shiki-dark:#C3E88D;"> redis7b</span><span style="--shiki-light:#005CC5;--shiki-dark:#C3E88D;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#C3E88D;"> 6378:6379</span><span style="--shiki-light:#005CC5;--shiki-dark:#C3E88D;"> -v</span><span style="--shiki-light:#032F62;--shiki-dark:#C3E88D;"> /docker/redis7b/conf:/etc/redis</span><span style="--shiki-light:#005CC5;--shiki-dark:#C3E88D;"> -v</span><span style="--shiki-light:#032F62;--shiki-dark:#C3E88D;"> /docker/redis7b/data:/data</span><span style="--shiki-light:#032F62;--shiki-dark:#C3E88D;"> redis:7</span><span style="--shiki-light:#032F62;--shiki-dark:#C3E88D;"> redis-server</span><span style="--shiki-light:#032F62;--shiki-dark:#C3E88D;"> /etc/redis/redis.conf</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>每个Redis实例的基础配置文件如下：</p><div class="language- line-numbers-mode" data-ext="" data-title=""><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes github-light material-theme-darker vp-code"><code><span class="line"><span># redis.conf</span></span>
<span class="line"><span></span></span>
<span class="line"><span># bind 127.0.0.1 -::1</span></span>
<span class="line"><span>port 6379</span></span>
<span class="line"><span># 开启保护模式</span></span>
<span class="line"><span>protected-mode yes</span></span>
<span class="line"><span># 密码</span></span>
<span class="line"><span>requirepass foobared</span></span>
<span class="line"><span></span></span>
<span class="line"><span># RDB持久化配置</span></span>
<span class="line"><span># save 3600 1 300 100 60 10000</span></span>
<span class="line"><span>dbfilename dump.rdb</span></span>
<span class="line"><span># dir ./</span></span>
<span class="line"><span>dir /data</span></span>
<span class="line"><span></span></span>
<span class="line"><span># AOF持久化配置</span></span>
<span class="line"><span>appendonly no</span></span>
<span class="line"><span>appendfilename &quot;appendonly.aof&quot;</span></span>
<span class="line"><span># appendfsync always</span></span>
<span class="line"><span>appendfsync everysec</span></span>
<span class="line"><span># appendfsync no</span></span>
<span class="line"><span></span></span>
<span class="line"><span>auto-aof-rewrite-percentage 100</span></span>
<span class="line"><span>auto-aof-rewrite-min-size 64mb</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="配置slave实例" tabindex="-1"><a class="header-anchor" href="#配置slave实例"><span>配置slave实例</span></a></h4><p>在2台slave实例的配置文件中，配置master实例的IP、端口、认证信息。</p><div class="language- line-numbers-mode" data-ext="" data-title=""><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes github-light material-theme-darker vp-code"><code><span class="line"><span># replicaof &lt;masterip&gt; &lt;masterport&gt;</span></span>
<span class="line"><span>replicaof 172.17.0.2 6379</span></span>
<span class="line"><span></span></span>
<span class="line"><span># masterauth &lt;master-password&gt;</span></span>
<span class="line"><span>masterauth foobared</span></span>
<span class="line"><span></span></span>
<span class="line"><span># masteruser &lt;username&gt;</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 从节点只读</span></span>
<span class="line"><span>replica-read-only yes</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 是否禁用主节点无延迟发送TCP数据包</span></span>
<span class="line"><span>repl-disable-tcp-nodelay no</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="启动redis实例" tabindex="-1"><a class="header-anchor" href="#启动redis实例"><span>启动Redis实例</span></a></h4><p>1.启动master实例</p><p><code>docker start redis7</code></p><p>2.启动2台slave实例</p><p><code>docker start redis7a redis7b</code></p><p>此时，查看master实例的日志，可以看到，2台slave实例成功连接到了master实例</p><p><code>docker logs redis7</code></p><p><img src="`+t+'" alt=""></p><h4 id="验证" tabindex="-1"><a class="header-anchor" href="#验证"><span>验证</span></a></h4><p>在master实例中，设置键值对&quot;hello=world&quot;</p><p><img src="'+r+'" alt=""></p><p>在2台slave实例中，查看键&quot;hello&quot;的值，成功获取到&quot;world&quot;</p><p><img src="'+c+'" alt=""></p><h3 id="使用命令指定主从关系" tabindex="-1"><a class="header-anchor" href="#使用命令指定主从关系"><span>使用命令指定主从关系</span></a></h3><p>使用<code>slaveof</code>命令，语法如下：</p><p><code>SLAVEOF &lt;host port | NO ONE&gt;</code></p><p>可以临时指定当前Redis实例作为slave</p><p><code>slaveof 172.17.0.2 6379</code></p><p>或者，取消主从关系（成为master）</p><p><code>slaveof no one</code></p><h2 id="哨兵模式" tabindex="-1"><a class="header-anchor" href="#哨兵模式"><span>哨兵模式</span></a></h2><blockquote><p>参考：https://redis.io/docs/management/sentinel/</p></blockquote><p>Redis哨兵（Redis Sentinel）可以监控主从架构中的Redis数据节点实例，当master实例故障时，自动选举1个slave实例，将其升级为新的master实例，实现自动故障发现与转移，确保系统的高可用与容错性。</p><p>Redis本身可以使用sentinel模式运行，支持以下2种启动方式：</p><ul><li><code>redis-sentinel /path/to/sentinel.conf</code></li><li><code>redis-server /path/to/sentinel.conf --sentinel</code></li></ul><p>Redis哨兵数量为奇数，且推荐哨兵数量不少于3个。</p><p>典型的&quot;哨兵+主从复制&quot;拓扑图如下：</p><p><img src="'+h+`" alt=""></p><h3 id="快速开始-1" tabindex="-1"><a class="header-anchor" href="#快速开始-1"><span>快速开始</span></a></h3><h4 id="环境准备-1" tabindex="-1"><a class="header-anchor" href="#环境准备-1"><span>环境准备</span></a></h4><p>使用3个Sentinel节点 + 1个master数据节点 + 2个slave数据节点的架构。</p><p>其中，数据节点使用主从复制时创建的docker容器。</p><p><strong>创建3个docker容器作为Redis哨兵</strong></p><blockquote><p>哨兵节点端口为26379</p></blockquote><p>哨兵实例x</p><div class="language- line-numbers-mode" data-ext="" data-title=""><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes github-light material-theme-darker vp-code"><code><span class="line"><span>mkdir -p /docker/redis7-sentinel-a/conf/</span></span>
<span class="line"><span>touch /docker/redis7-sentinel-a/conf/sentinel.conf</span></span>
<span class="line"><span></span></span>
<span class="line"><span>docker create --name redis7-sentinel-a -p 26370:26379 -v /docker/redis7-sentinel-a/conf:/etc/redis -v /docker/redis7-sentinel-a/data:/data redis:7 redis-sentinel /etc/redis/sentinel.conf</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>哨兵实例y</p><div class="language- line-numbers-mode" data-ext="" data-title=""><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes github-light material-theme-darker vp-code"><code><span class="line"><span>mkdir -p /docker/redis7-sentinel-b/conf/</span></span>
<span class="line"><span>touch /docker/redis7-sentinel-b/conf/sentinel.conf</span></span>
<span class="line"><span></span></span>
<span class="line"><span>docker create --name redis7-sentinel-b -p 26371:26379 -v /docker/redis7-sentinel-b/conf:/etc/redis -v /docker/redis7-sentinel-b/data:/data redis:7 redis-sentinel /etc/redis/sentinel.conf</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>哨兵实例z</p><div class="language- line-numbers-mode" data-ext="" data-title=""><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes github-light material-theme-darker vp-code"><code><span class="line"><span>mkdir -p /docker/redis7-sentinel-c/conf/</span></span>
<span class="line"><span>touch /docker/redis7-sentinel-c/conf/sentinel.conf</span></span>
<span class="line"><span></span></span>
<span class="line"><span>docker create --name redis7-sentinel-c -p 26372:26379 -v /docker/redis7-sentinel-c/conf:/etc/redis -v /docker/redis7-sentinel-c/data:/data redis:7 redis-sentinel /etc/redis/sentinel.conf</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="配置哨兵实例" tabindex="-1"><a class="header-anchor" href="#配置哨兵实例"><span>配置哨兵实例</span></a></h4><p>在每一个哨兵节点的<em>sentinel.conf</em>配置文件中，配置哨兵监听的主节点IP、端口、<strong>判定主节点故障所需要的票数</strong>，以及主节点的认证信息等。</p><p>如果哨兵要同时监控多个主节点，只需要添加主节点名称不同的配置即可。</p><div class="language- line-numbers-mode" data-ext="" data-title=""><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes github-light material-theme-darker vp-code"><code><span class="line"><span># bind 127.0.0.1</span></span>
<span class="line"><span>port 26379</span></span>
<span class="line"><span></span></span>
<span class="line"><span>protected-mode no</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 配置master实例</span></span>
<span class="line"><span>sentinel monitor mymaster 172.17.0.2 6379 2</span></span>
<span class="line"><span># sentinel auth-user &lt;master-name&gt; &lt;username&gt;</span></span>
<span class="line"><span>sentinel auth-pass mymaster foobared</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 判定节点下线的超时时间，默认30s</span></span>
<span class="line"><span>sentinel down-after-milliseconds mymaster 30000</span></span>
<span class="line"><span># 当选出新的主节点后，允许同时向主节点发起复制操作的从节点数量</span></span>
<span class="line"><span>sentinel parallel-syncs mymaster 1</span></span>
<span class="line"><span>sentinel failover-timeout mymaster 180000</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="启动哨兵实例" tabindex="-1"><a class="header-anchor" href="#启动哨兵实例"><span>启动哨兵实例</span></a></h4><p>先启动Redis主从节点</p><p><code>docker start redis7a redis7b redis7c</code></p><p>再启动哨兵节点</p><p><code>docker start redis7-sentinel-a redis7-sentinel-b redis7-sentinel-c</code></p><h4 id="验证-1" tabindex="-1"><a class="header-anchor" href="#验证-1"><span>验证</span></a></h4><p>进入任意一个哨兵节点容器</p><p><code>docker exec -it redis7-sentinel-a redis-cli -p 26379</code></p><p>运行 <code>info sentinel</code>命令，查看哨兵信息</p><p>关闭主节点</p><p><code>docker stop redis7</code></p><p>查看主从节点信息</p><p><code>info replication</code></p><h2 id="集群" tabindex="-1"><a class="header-anchor" href="#集群"><span>集群</span></a></h2><h3 id="搭建集群" tabindex="-1"><a class="header-anchor" href="#搭建集群"><span>搭建集群</span></a></h3><h4 id="_1-准备节点" tabindex="-1"><a class="header-anchor" href="#_1-准备节点"><span>1.准备节点</span></a></h4><h4 id="_2-节点握手" tabindex="-1"><a class="header-anchor" href="#_2-节点握手"><span>2.节点握手</span></a></h4><p><code>cluster meet ip port</code></p><h4 id="_3-给每个主节点分配槽" tabindex="-1"><a class="header-anchor" href="#_3-给每个主节点分配槽"><span>3.给每个主节点分配槽</span></a></h4><p>将16384（0-16383）个槽分配给集群中的主节点。</p><p><code>cluster addslots 0-5000</code></p><h4 id="_4-为每个从节点设置要复制的主节点" tabindex="-1"><a class="header-anchor" href="#_4-为每个从节点设置要复制的主节点"><span>4.为每个从节点设置要复制的主节点</span></a></h4><p><code>cluster replicate node-id</code></p>`,136)]))}const u=a(o,[["render",k],["__file","index.html.vue"]]),b=JSON.parse('{"path":"/notes/database/wd2r9kcw/","title":"Redis高可用机制","lang":"zh-CN","frontmatter":{"title":"Redis高可用机制","createTime":"2024/11/24 15:56:14","permalink":"/notes/database/wd2r9kcw/"},"headers":[],"readingTime":{"minutes":7.74,"words":2321},"git":{"updatedTime":1733057441000,"contributors":[{"name":"ianping","email":"13520322212@163.com","commits":2,"avatar":"https://avatars.githubusercontent.com/ianping?v=4","url":"https://github.com/ianping"}]},"filePathRelative":"notes/database/6.redis/Redis高可用机制.md","bulletin":false}');export{u as comp,b as data};
