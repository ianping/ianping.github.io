import{_ as i,c as a,b as n,o as e}from"./app-DsGHT65_.js";const l={};function p(t,s){return e(),a("div",null,s[0]||(s[0]=[n(`<p>参考：</p><ul><li>https://nacos.io/docs/latest/what-is-nacos/</li><li>https://github.com/alibaba/nacos</li></ul><p>版本信息：</p><ul><li>nacos 2.2.3</li></ul><h2 id="下载" tabindex="-1"><a class="header-anchor" href="#下载"><span>下载</span></a></h2><p>https://github.com/alibaba/nacos/releases</p><h2 id="单机模式" tabindex="-1"><a class="header-anchor" href="#单机模式"><span>单机模式</span></a></h2><p><strong>安装</strong></p><p>解压到安装目录即可。</p><p><strong>启动</strong></p><p><code>cd path/to/nacos/bin/</code></p><p><code>startup.cmd -m standalone</code></p><p>访问 http://localhost:8848/nacos/</p><p><strong>停止</strong></p><p><code>shutdown.cmd</code></p><h2 id="使用mysql数据库存储数据" tabindex="-1"><a class="header-anchor" href="#使用mysql数据库存储数据"><span>使用mysql数据库存储数据</span></a></h2><p>1.创建数据库nacos</p><p>2.初始化数据库，执行初始化sql文件 <em>nacos/config/mysql-schema.sql</em></p><p>3.修改 <em>nacos/config/application.properties</em></p><div class="language-properties line-numbers-mode" data-ext="properties" data-title="properties"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">### If use MySQL as datasource:</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">### Deprecated configuration property, it is recommended to use \`spring.sql.init.platform\` replaced.</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#spring.datasource.platform=mysql</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">spring.sql.init.platform</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">mysql</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">### Count of DB:</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">db.num</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">1</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">### Connect URL of DB:</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">db.url.0</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">jdbc:mysql://172.30.149.49:3306/nacos?</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">characterEncoding</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">utf8&amp;</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">connectTimeout</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">1000&amp;</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">socketTimeout</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">3000&amp;</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">autoReconnect</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">true&amp;</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">useUnicode</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">true&amp;</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">useSSL</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">false&amp;</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">allowPublicKeyRetrieval</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">true&amp;</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">serverTimezone</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">Asia/Shanghai</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">db.user.0</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">root</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">db.password.0</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">root</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>4.重启nacos</p><h2 id="开启用户鉴权" tabindex="-1"><a class="header-anchor" href="#开启用户鉴权"><span>开启用户鉴权</span></a></h2><p>修改 <em>nacos/config/application.properties</em></p><div class="language-properties line-numbers-mode" data-ext="properties" data-title="properties"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">### The auth system to use, currently only &#39;nacos&#39; and &#39;ldap&#39; is supported:</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">nacos.core.auth.system.type</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">nacos</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">### 开启鉴权</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">nacos.core.auth.enabled</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">true</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">### Turn on/off caching of auth information. By turning on this switch, the update of auth information would have a 15 seconds delay.</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">nacos.core.auth.caching.enabled</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">true</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">### Since 1.4.1, Turn on/off white auth for user-agent: nacos-server, only for upgrade from old version.</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">nacos.core.auth.enable.userAgentAuthWhite</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">false</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">### Since 1.4.1, worked when nacos.core.auth.enabled=true and nacos.core.auth.enable.userAgentAuthWhite=false.</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">### 用户名/密码</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">nacos.core.auth.server.identity.key</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">nacos</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">nacos.core.auth.server.identity.value</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">nacos</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">### worked when nacos.core.auth.system.type=nacos</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">### The token expiration in seconds:</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">nacos.core.auth.plugin.nacos.token.cache.enable</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">false</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">nacos.core.auth.plugin.nacos.token.expire.seconds</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">18000</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">### JWT Token密钥(推荐使用原始密钥的Base64，原始密钥不能小于32个字符)</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">nacos.core.auth.plugin.nacos.token.secret.key</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">MTIzNDU2Nzg5MDEyMzQ1Njc4OTAxMjM0NTY3ODkwMTIzNDU2Nzg5MA</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">=</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="集群模式" tabindex="-1"><a class="header-anchor" href="#集群模式"><span>集群模式</span></a></h2><p>3台以上的Nacos服务器 + Nginx负载均衡。</p><p>这里使用单机多端口方案；</p><p>1.下载并上传nacos安装包到每一台服务器，并解压</p><p>2.配置外部数据源、开启鉴权</p><p>3.在每个nacos的conf目录下，创建 <em>cluster.conf</em> 文件，配置集群地址(IP:PORT)</p><div class="language- line-numbers-mode" data-ext="" data-title=""><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>169.254.135.41:8845</span></span>
<span class="line"><span>169.254.135.41:8846</span></span>
<span class="line"><span>169.254.135.41:8847</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>4.修改每个nacos的 <em>conf/application.properties</em> 配置文件，设置其端口号分别为8845, 8846, 8847</p><p>5.分别启动每个nacos，默认启动模式是cluster</p><p><code>startup.cmd</code> 或 <code>startup.sh</code></p><p>6.配置nginx负载均衡，nginx监听8848端口，转发到nacos集群</p><div class="language- line-numbers-mode" data-ext="" data-title=""><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>upstream nacos-cluster {</span></span>
<span class="line"><span>    server 169.254.135.41:8847;</span></span>
<span class="line"><span>    server 169.254.135.41:8846;</span></span>
<span class="line"><span>    server 169.254.135.41:8845;</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>server {</span></span>
<span class="line"><span>    listen       8848;</span></span>
<span class="line"><span>    server_name  localhost;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    #charset koi8-r;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    #access_log  logs/host.access.log  main;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    location /nacos {</span></span>
<span class="line"><span>    	proxy_pass http://nacos-cluster;</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>7.验证</p><p>nacos客户端应用中，配置nacos地址为nginx8848</p><div class="language-properties line-numbers-mode" data-ext="properties" data-title="properties"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">spring.cloud.nacos.server-addr</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">127.0.0.1:8848</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">spring.cloud.nacos.username</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">nacos</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">spring.cloud.nacos.password</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">nacos</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>启动应用，成功注册到nacos注册中心。</p><p>如果启动报错：<em>did not find the Leader node;caused: The Raft Group [naming_persistent_service_v2] did not find the Leader node;</em>，是因为nacos安装文件是直接复制的，包含了自动生成的 <em>data/protocol/raft</em> 文件，将其删除，重启nacos即可。</p><h2 id="多集群模式" tabindex="-1"><a class="header-anchor" href="#多集群模式"><span>多集群模式</span></a></h2>`,42)]))}const d=i(l,[["render",p],["__file","index.html.vue"]]),r=JSON.parse('{"path":"/notes/java/xgvwqrlg/","title":"SpringCloudAlibaba Nacos","lang":"zh-CN","frontmatter":{"title":"SpringCloudAlibaba Nacos","createTime":"2024/11/24 15:56:15","permalink":"/notes/java/xgvwqrlg/"},"headers":[],"readingTime":{"minutes":1.9,"words":571},"git":{"updatedTime":1732441916000,"contributors":[{"name":"ianping","email":"13520322212@163.com","commits":1,"avatar":"https://avatars.githubusercontent.com/ianping?v=4","url":"https://github.com/ianping"}]},"filePathRelative":"notes/java/springcloud/SpringCloudAlibaba Nacos.md","bulletin":false}');export{d as comp,r as data};
